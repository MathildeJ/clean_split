<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Splitscreen</title>

<link href="../static/splitscreen.css" rel="stylesheet">
<link href="../static/leader_side.css" rel="stylesheet">

<script>
	(function(s,u,r,f,l,y){s[f]=s[f]||{init:function(){s[f].q=arguments}};
	l=u.createElement(r);y=u.getElementsByTagName(r)[0];l.async=1;
	l.src='https://surfly-s1.com/surfly.js';y.parentNode.insertBefore(l,y);})
	(window,document,'script','Surfly');
    </script>

    <script>
	var settings = {widgetkey:'b84defc4621441ecae5eb10bdec1cb5a', block_until_agent_joins: false};
	window.addEventListener('DOMContentLoaded', function() {
	  Surfly.init(settings, function(init) {
	    if (init.success) {
	      if(!Surfly.currentSession){
		      s = Surfly.session();
                      s._settings.url = 'https://www.google.nl';
			s.on('session_started', function(session) {
			       // get the session id from the follower link
				var followerLink = session.followerLink;
				var linkIndex = followerLink.indexOf(".com");
				var sessionID = followerLink.substring(linkIndex+4, linkIndex+16);
				// get the page url
				var pageUrl = document.location.href;
				var pageIndex = pageUrl.indexOf("https");
				var pageEnd = pageUrl.indexOf("first_frame");
				var fullPageUrl = pageUrl.substring(pageIndex, pageEnd-1);
				// append the page url to the session id
                                res = fullPageUrl.concat('/splitscreen', sessionID);
        

		      })
		      .startLeader('#ifrm1');
		} 
	     }
	   });
	 });

    // send the link to the top page (popup)
    //var popupWindow = document.getElementById('popupWindow').contentWindow;
    //                            popupWindow.postMessage("link to open: " + res, "*");

    </script>

</head>

<body>
<!--<button id="button-start" onclick="setTimeout(update, 4000)" style="visibility:hidden"> Take session </button>-->
<div id="invite" style="visibility:hidden">Invite link</div>
<a id="invite_a" style="visibility:hidden">Invite link</a>

<div class="box"><iframe id="ifrm1" src="" height="700" width="49%" align='left'></iframe></div>
<div class="box"><iframe id="ifrm2" src="./fourth_frame" height="700" width="49%" align='right' style="background-image: url(../static/beer.jpg); background-size: cover;"></iframe></div>

<script>
var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
var eventer = window[eventMethod];
var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

// Listen to message from child IFrame window
eventer(messageEvent, function (e) {
   var info = JSON.stringify(e.data);

   if(info.indexOf('link to open')!==-1){
	// if we re
	var invite_link = document.getElementById('invite');
	var invite = document.getElementById('invite_a');
	invite_link.innerHTML = e.data;
	invite_link.style.visibility = 'visible';
	invite.href = e.data.substring(14);
	invite.style.visibility = 'visible';
   }

   if(info.indexOf('flink')!==-1){
	var link = e.data.substring(7);
	if(link.indexOf('\\')){ link = link.substring(0, link.length);};
	console.log('it works? ' + link);
	document.getElementById('ifrm2').src = link;
	document.getElementById('invite').style.visibility = 'hidden';
	document.getElementById('invite_a').style.visibility = 'hidden';
   }
}, false);
</script>

</body>

</html>
